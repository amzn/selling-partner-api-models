# Selling Partner API Authentication/Authorization Library
This library provides helper classes for use when signing HTTP requests for Amazon Selling Partner APIs. It is intended for use
with the Selling Partner API Client Libraries generated by [openapi generator](https://openapi-generator.tech/)
using the Guzzlehttp library. It can also be integrated into custom projects.

## LWAAuthorizationSigner
Obtains and signs a request with an access token from LWA (Login with Amazon) for the specified endpoint using the provided LWA credentials.

*Example*
```
$request = new \GuzzleHttp\Psr7\Request(
    "method", "uri", ...
);

// Seller APIs

$lwaAuthorizationCredentials = new LWAAuthorizationCredentials([
    "clientId" => "...",
    "clientSecret" => "...",
    "refreshToken" => "...",
    "endpoint" => "..."
]);

/* Sellerless APIs
The Selling Partner API scopes can be retrieved from the ScopeConstants class and passed as 
argument(s) to either the "scopes" => "..." or setScopes(...) method during 
lwaAuthorizationCredentials object instantiation. 
*/

use SpApi\AuthAndAuth\ScopeConstants;

$lwaAuthorizationCredentials = new LWAAuthorizationCredentials([
    "clientId" => "...",
    "clientSecret" => "...",
    "scopes" => "...",
    "endpoint" => "..."
]);

$signedRequest = (new LWAAuthorizationSigner($lwaAuthorizationCredentials))
    ->sign($request);
```

## AWSSigV4Signer
Signs a request with [AWS Signature Version 4](https://docs.aws.amazon.com/general/latest/gr/signature-version-4.html)
using the provided AWS developer account credentials.

*Example*
```
$request = new \GuzzleHttp\Psr7\Request(
    "method", "uri", ...
);

$awsAuthenticationCredentials = new AWSAuthenticationCredentials([
    "accessKeyId" => "...",
    "secretKey" => "...",
    "region" => "..."
]);

$signedRequest = (new AWSSigV4Signer($awsAuthenticationCredentials))
    ->sign($request);

/*Signs request using IAM role credentials.*/

$awsAuthenticationCredentialsProvider = new AWSAuthenticationCredentialsProvider([
    "roleArn" => "...",
    "roleSessionName" => "..."
]);

$signedRequest = (
    new AWSSigV4Signer(
        $awsAuthenticationCredentials, $awsAuthenticationCredentialsProvider
    ))
    ->sign($request);
```

## LWAAccessTokenCache
Implements cache for access token that is returned in LWAClient and reuses the access token until time to live.

## RateLimitConfiguration
Interface to set and get rateLimit configurations that are used with RateLimiter. RateLimiter is used on client side to restrict the rate at which requests are made. RateLimitConfiguration takes a Permit, the rate at which requests are made, and TimeOut.

*Example*
```
$rateLimitOption = new RateLimitConfigurationOnRequests([
    "rateLimitToken" => "...",
    "rateLimitTokenLimit" => "...",
    "waitTimeOutInMilliSeconds" => "..."
]);
```

## Resources
This package features Mustache templates designed for use with [openapi generator](https://openapi-generator.tech/).
When you build Selling Partner API OpenAPI models with these templates, they help generate a rich SDK with functionality to invoke Selling Partner APIs built in. The templates are located in *resources/openapi-generator*.

Dependencies are declared in the composer.json file.

## License
OpenAPI Generator templates are subject to the [OpenAPI Generator License](https://github.com/OpenAPITools/openapi-generator/blob/v5.2.1/LICENSE).

All other work licensed as follows:

Copyright 2019 Amazon.com, Inc

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this library except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
